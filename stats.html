
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stats Calculator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #cbfcda, #b1dceb);
      color: #222;
    }
    header, nav, footer {
      text-align: center;
      background: #fff;
    }
    header img {
      max-width: 340px;
      height: auto;
      margin-top: 10px;
    }
    nav a {
      margin: 0 1em;
      color: #333;
      text-decoration: none;
      font-weight: 500;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .container {
      max-width: 900px;
      margin: 2em auto;
      padding: 1em;
    }
    input[type="number"] {
      width: 60px;
    }
    textarea {
      width: 100%;
      height: 100px;
    }
    canvas {
      margin-top: 2em;
      max-width: 100%;
    }
    .output-box {
      background: #fff;
      border-radius: 8px;
      padding: 1em;
      margin-top: 1em;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <header>
    <a href="index.html">
      <img src="logo2nobg.png" alt="BEDHEAD Logo">
    </a>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="about.html">About Us</a>
    <a href="howto.html">How to Use Your Journal</a>
    <a href="resources.html">Resources</a>
    <a href="vitamindex.html">Vitamindex</a>
    <a href="soundbath.html">Soundbath Room</a>
    <a href="stats.html">Stats Calculator</a>
  </nav>

  <div class="container">
    <h2>Weekly r Variance</h2>
    <p>Enter your four weekly r values:</p>
    <input id="r1" type="number" step="any"> 
    <input id="r2" type="number" step="any"> 
    <input id="r3" type="number" step="any"> 
    <input id="r4" type="number" step="any"> 
    <button onclick="calculateVariance()">Calculate</button>
    <div class="output-box" id="varianceResult"></div>

    <h2>Monthly Correlation</h2>
    <p>Enter up to 28 days of data. Leave blanks if not applicable.</p>
    <textarea id="activityInput" placeholder="Enter 28 activity counts, comma-separated"></textarea>
    <textarea id="symptomInput" placeholder="Enter 28 symptom counts, comma-separated"></textarea>
    <button onclick="calculateCorrelation()">Calculate</button>
    <div class="output-box" id="correlationResult"></div>
    <canvas id="correlationChart" height="100"></canvas>
  </div>

  <footer style="text-align:center; padding:2em; font-size: 0.9em; color: #555;">
    <a href="faq.html">FAQ</a> • <a href="contact.html">Contact Us</a>
    <p style="margin-top: 1em;">© BEDHEAD Journal. All rights reserved.</p>
  </footer>

  <script>
    function calculateVariance() {
      const values = [r1.value, r2.value, r3.value, r4.value].map(Number);
      const avg = values.reduce((a, b) => a + b) / values.length;
      const variance = values.map(r => (r - avg) ** 2).reduce((a, b) => a + b) / values.length;
      let message = "";

      if (variance < 0.02) message = "Extremely stable month.";
      else if (variance < 0.05) message = "Mild fluctuation — low variance.";
      else if (variance <= 0.1) message = "Moderate inconsistency.";
      else if (variance <= 0.2) message = "High variability.";
      else message = "Very high — correlations flip/flop.";

      document.getElementById("varianceResult").innerHTML = `<strong>Variance:</strong> ${variance.toFixed(4)}<br>${message}`;
    }

    function calculateCorrelation() {
      const activities = document.getElementById("activityInput").value.split(",").map(Number).filter(n => !isNaN(n));
      const symptoms = document.getElementById("symptomInput").value.split(",").map(Number).filter(n => !isNaN(n));

      if (activities.length !== symptoms.length || activities.length === 0) {
        alert("Please ensure both fields have equal number of valid entries.");
        return;
      }

      const n = activities.length;
      const avgA = activities.reduce((a, b) => a + b) / n;
      const avgS = symptoms.reduce((a, b) => a + b) / n;

      const numerator = activities.reduce((sum, a, i) => sum + (a - avgA) * (symptoms[i] - avgS), 0);
      const denominator = Math.sqrt(
        activities.reduce((sum, a) => sum + (a - avgA) ** 2, 0) *
        symptoms.reduce((sum, s) => sum + (s - avgS) ** 2, 0)
      );
      const r = numerator / denominator;

      let explanation = "";
      if (r <= -0.7) explanation = "Strong negative correlation — more activity = noticeably fewer symptoms.";
      else if (r <= -0.4) explanation = "Weak negative correlation — more activity = a bit fewer symptoms.";
      else if (r < 0.4) explanation = "No clear pattern — activity and symptoms don't track consistently.";
      else if (r < 0.7) explanation = "Weak positive correlation — more activity = more symptoms.";
      else explanation = "Strong positive correlation — more activity = way more symptoms.";

      document.getElementById("correlationResult").innerHTML = `<strong>Correlation (r):</strong> ${r.toFixed(4)}<br>${explanation}`;

      const ctx = document.getElementById("correlationChart").getContext("2d");
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: [...Array(n).keys()].map(i => `Day ${i+1}`),
          datasets: [
            {
              label: "Activities",
              type: "bar",
              data: activities,
              backgroundColor: 'rgba(189, 236, 203, 0.6)',
              borderColor: 'rgba(189, 236, 203, 1)',
              borderWidth: 1,
              order: 1
            },
            {
              label: "Symptoms",
              type: "line",
              data: symptoms,
              borderColor: 'rgba(150, 187, 227, 1)',
              backgroundColor: 'rgba(150, 187, 227, 0.3)',
              fill: false,
              tension: 0.3,
              order: 2
            }
          ]
        },
        options: {
          responsive: true,
          plugins: { legend: { position: 'top' } },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
  </script>
</body>
</html>
